"0","library(""reticulate"")"
"0","library(""lmtest"")"
"0","library(""tidyverse"")"
"0","library(""plotROC"")"
"0","library(""glmnet"")"
"0",""
"0","heart <- py$heart"
"2","sys:1: FutureWarning: RangeIndex._start is deprecated and will be removed in a future version. Use RangeIndex.start instead
sys:1: FutureWarning: RangeIndex._stop is deprecated and will be removed in a future version. Use RangeIndex.stop instead
sys:1: FutureWarning: RangeIndex._step is deprecated and will be removed in a future version. Use RangeIndex.step instead
"
"0","# Define class_diags function:"
"0","class_diag<-function(probs,truth){"
"0","  "
"0","  tab<-table(factor(probs>.5,levels=c(""FALSE"",""TRUE"")),truth)"
"0","  acc=sum(diag(tab))/sum(tab)"
"0","  sens=tab[2,2]/colSums(tab)[2]"
"0","  spec=tab[1,1]/colSums(tab)[1]"
"0","  ppv=tab[2,2]/rowSums(tab)[2]"
"0",""
"0","  if(is.numeric(truth)==FALSE & is.logical(truth)==FALSE) truth<-as.numeric(truth)-1"
"0","  "
"0","  #CALCULATE EXACT AUC"
"0","  ord<-order(probs, decreasing=TRUE)"
"0","  probs <- probs[ord]; truth <- truth[ord]"
"0","  "
"0","  TPR=cumsum(truth)/max(1,sum(truth)) "
"0","  FPR=cumsum(!truth)/max(1,sum(!truth))"
"0","  "
"0","  dup<-c(probs[-1]>=probs[-length(probs)], FALSE)"
"0","  TPR<-c(0,TPR[!dup],1); FPR<-c(0,FPR[!dup],1)"
"0","  "
"0","  n <- length(TPR)"
"0","  auc<- sum( ((TPR[-1]+TPR[-n])/2) * (FPR[-1]-FPR[-n]) )"
"0",""
"0","  data.frame(acc,sens,spec,ppv,auc)"
"0","}"
"0",""
"0","heart$cp <- as.factor(heart$cp)"
"0","heart$sex <- as.factor(heart$sex)"
"0","heart$fbs <- as.factor(heart$fbs)"
"0","heart$slope <- as.factor(heart$slope)"
"0","heart$thal <- as.factor(heart$thal)"
"0","heart$ca <- as.factor(heart$ca)"
"0","heart <- heart %>% mutate(chol_c= chol - mean(chol), trestbps_c=trestbps - mean(trestbps),exang=as.factor(exang))"
"0",""
"0",""
"0","heartLassoFit <- glm(target~(.), data=heart, family=""binomial"")"
"0","summary(heartLassoFit)"
"1","
Call:
"
"1",""
"1","glm(formula = target ~ (.), family = ""binomial"", data = heart)"
"1",""
"1","

"
"1","Deviance Residuals: 
"
"1","    Min  "
"1","     1Q  "
"1"," Median  "
"1","     3Q  "
"1","    Max  "
"1","
"
"1","-2.9459  "
"1","-0.2917  "
"1"," 0.1024  "
"1"," 0.4479  "
"1"," 3.1401  "
"1","
"
"1","
Coefficients: ("
"1",""
"1","2"
"1",""
"1"," not defined because of singularities)
"
"1","           "
"1","  Estimate"
"1"," Std. Error"
"1"," z value"
"1"," Pr(>|z|)"
"1","    "
"1","
(Intercept)"
"1","  0.256315"
"1","   3.717325"
"1","   0.069"
"1"," 0.945028"
"1","    "
"1","
age        "
"1","  0.027711"
"1","   0.025461"
"1","   1.088"
"1"," 0.276436"
"1","    "
"1","
sex1       "
"1"," -1.845598"
"1","   0.570225"
"1","  -3.237"
"1"," 0.001210"
"1"," ** "
"1","
cp1        "
"1","  0.872344"
"1","   0.578449"
"1","   1.508"
"1"," 0.131535"
"1","    "
"1","
cp2        "
"1","  2.017603"
"1","   0.530174"
"1","   3.806"
"1"," 0.000141"
"1"," ***"
"1","
cp3        "
"1","  2.427691"
"1","   0.718961"
"1","   3.377"
"1"," 0.000734"
"1"," ***"
"1","
trestbps   "
"1"," -0.026755"
"1","   0.011778"
"1","  -2.272"
"1"," 0.023108"
"1"," *  "
"1","
chol       "
"1"," -0.004489"
"1","   0.004202"
"1","  -1.068"
"1"," 0.285391"
"1","    "
"1","
fbs1       "
"1","  0.461956"
"1","   0.589685"
"1","   0.783"
"1"," 0.433395"
"1","    "
"1","
restecg    "
"1","  0.398460"
"1","   0.383928"
"1","   1.038"
"1"," 0.299339"
"1","    "
"1","
thalach    "
"1","  0.020396"
"1","   0.011853"
"1","   1.721"
"1"," 0.085297"
"1"," .  "
"1","
exang1     "
"1"," -0.778793"
"1","   0.451888"
"1","  -1.723"
"1"," 0.084813"
"1"," .  "
"1","
oldpeak    "
"1"," -0.416509"
"1","   0.240005"
"1","  -1.735"
"1"," 0.082667"
"1"," .  "
"1","
slope1     "
"1"," -0.756969"
"1","   0.873155"
"1","  -0.867"
"1"," 0.385978"
"1","    "
"1","
slope2     "
"1","  0.705157"
"1","   0.941443"
"1","   0.749"
"1"," 0.453847"
"1","    "
"1","
ca1        "
"1"," -2.356771"
"1","   0.526311"
"1","  -4.478"
"1"," 7.54e-06"
"1"," ***"
"1","
ca2        "
"1"," -3.462666"
"1","   0.811700"
"1","  -4.266"
"1"," 1.99e-05"
"1"," ***"
"1","
ca3        "
"1"," -2.294901"
"1","   0.935058"
"1","  -2.454"
"1"," 0.014116"
"1"," *  "
"1","
ca4        "
"1","  1.240056"
"1","   1.704808"
"1","   0.727"
"1"," 0.466989"
"1","    "
"1","
thal1      "
"1","  2.636985"
"1","   2.705956"
"1","   0.975"
"1"," 0.329803"
"1","    "
"1","
thal2      "
"1","  2.372031"
"1","   2.618241"
"1","   0.906"
"1"," 0.364955"
"1","    "
"1","
thal3      "
"1","  0.934193"
"1","   2.622063"
"1","   0.356"
"1"," 0.721630"
"1","    "
"1","
chol_c     "
"1","        NA"
"1","         NA"
"1","      NA"
"1","       NA"
"1","    "
"1","
trestbps_c "
"1","        NA"
"1","         NA"
"1","      NA"
"1","       NA"
"1","    "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
(Dispersion parameter for "
"1",""
"1","binomial"
"1",""
"1"," family taken to be "
"1",""
"1","1"
"1",""
"1",")

"
"1",""
"1","    Null deviance: 417.64  on 302  degrees of freedom
"
"1",""
"1","Residual deviance: 180.01  on 281  degrees of freedom
"
"1","AIC: "
"1",""
"1","224.01"
"1",""
"1","

"
"1",""
"1","Number of Fisher Scoring iterations: "
"1",""
"1","6"
"1",""
"1","
"
"1","
"
"0","heartmatrix <- model.matrix(heartLassoFit)"
"0","heartmatrix <- heartmatrix[,-1]"
"0",""
"0","heartresponse <- as.matrix(heart$target)"
"0",""
"0","cv.lasso1 <- cv.glmnet(x=heartmatrix, y=heartresponse, family=""binomial"")"
"0","lasso1 <- glmnet(x=heartmatrix, y=heartresponse, family=""binomial"", alpha=1, lambda=cv.lasso1$lambda.1se)"
"0","coef(lasso1)"
"1","24 x 1 sparse Matrix of class ""dgCMatrix""
"
"1","           "
"1","            s0"
"1","
(Intercept)"
"1"," -0.5094863504"
"1","
age        "
"1","  .           "
"1","
sex1       "
"1"," -0.4319320100"
"1","
cp1        "
"1","  0.1551520016"
"1","
cp2        "
"1","  0.7073576564"
"1","
cp3        "
"1","  0.3499649557"
"1","
trestbps   "
"1","  .           "
"1","
chol       "
"1","  .           "
"1","
fbs1       "
"1","  .           "
"1","
restecg    "
"1","  0.0004620286"
"1","
thalach    "
"1","  0.0109736364"
"1","
exang1     "
"1"," -0.6579701933"
"1","
oldpeak    "
"1"," -0.2951140398"
"1","
slope1     "
"1"," -0.3521833535"
"1","
slope2     "
"1","  0.1471810792"
"1","
ca1        "
"1"," -0.8897588438"
"1","
ca2        "
"1"," -1.2275361208"
"1","
ca3        "
"1"," -0.8151577620"
"1","
ca4        "
"1","  .           "
"1","
thal1      "
"1","  .           "
"1","
thal2      "
"1","  0.6479125436"
"1","
thal3      "
"1"," -0.5771256257"
"1","
chol_c     "
"1","  .           "
"1","
trestbps_c "
"1","  .           "
"1","
"
"0","# Set Explanatory Dummy variables in a new dataset with the acquired LASSO Non-zero Coefficients"
"0",""
"0","heart6 <- heart %>% mutate(sex1=ifelse(sex==""1"",1,0), cp1=ifelse(cp==""1"",1,0), cp2=ifelse(cp==""2"",1,0), "
"0","                           cp3=ifelse(cp==""3"",1,0), exang1=ifelse(exang==""1"",1,0),"
"0","                           slope1=ifelse(slope==""1"",1,0), slope2=ifelse(slope==""2"",1,0), "
"0","                           ca1=ifelse(ca==""1"",1,0), ca2=ifelse(ca==""2"",1,0), ca3=ifelse(ca==""3"",1,0),"
"0","                           thal2=ifelse(thal==""2"",1,0), thal3=ifelse(thal==""3"",1,0)) %>%"
"0","                    select(-sex, -cp, -chol, -fbs, -slope, -ca, -exang, -thal, -chol_c)"
"0","  "
"0","# 10-fold Out-of-Sample Cross Validation for LASSO Nonzero Coefficients"
"0",""
"0","k=10"
"0",""
"0","heart7<-heart6[sample(nrow(heart6)),] "
"0","folds<-cut(seq(1:nrow(heart6)),breaks=k,labels=F) "
"0",""
"0","diags<-NULL"
"0","for(i in 1:k){          "
"0","train<-heart7[folds!=i,] "
"0","test<-heart7[folds==i,]  "
"0",""
"0","truth<-test$target"
"0",""
"0","fit<- glm(target~(.), data=train, family=""binomial"")"
"0","probs<- predict(fit, newdata=test, type=""response"")"
"0",""
"0","diags<-rbind(diags,class_diag(probs,truth)) "
"0","}"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"2","prediction from a rank-deficient fit may be misleading"
"0","summarize_all(diags,mean)"
